"""データ収集用プロンプトテンプレート"""
from typing import Dict, Any


def generate_diary_prompt(content: str, has_optional_fields: bool) -> str:
    """日記記録時のデータ収集プロンプト"""

    if has_optional_fields:
        # すでに十分な情報がある場合
        return f"""
記録完了しました!

日記: {content}
"""

    # データが不足している場合、質問を促す
    return f"""
記録しますね。

より深い分析のために、いくつか質問させてください（答えるのは任意です）:

【今回の分析に必要】
- このことで新しく学んだことはありますか?
  → 例: 「エラーログの読み方」「API設計の基本」

- 過去の自分と比べてどうですか?
  → 例: 「前は1日かかったけど、今日は2時間でできた」
  → 例: 「先週はわからなかったが、今日は自分で調べて解決できた」

【将来の分析に役立つ情報】
- 他人は気づかないかもしれないけど、自分では成長したと思うことはありますか?
  → 例: 「コードを書く前に設計を考えるようになった」
  → 例: 「質問する前に自分で調べる習慣がついた」

- 誰かから評価やフィードバックを受けましたか?
  → 例: 「先輩から『まだまだ』と言われた」
  → 例: 「レビューで指摘された」

- 自分自身をどう評価しますか?
  → 例: 「まだ遅いけど、少しずつ進んでいる」
  → 例: 「思ったより理解できた」

回答があれば、以下のコマンドで追記してください:

```bash
clap diary update {content[:20]}... --learned "..." --compared "..." --invisible "..." --external "..." --self-eval "..."
```

または、最初から記録し直す場合:

```bash
clap diary write "{content}" --learned "..." --compared "..." [その他のオプション]
```
"""


def generate_task_done_prompt(task_title: str, has_optional_fields: bool) -> str:
    """タスク完了時のデータ収集プロンプト"""

    if has_optional_fields:
        return f"""
タスク完了を記録しました!

タスク: {task_title}
"""

    return f"""
お疲れ様です!完了を記録しますね。

成長を可視化するために、いくつか質問させてください（答えるのは任意です）:

【今すぐ答えてほしい - 理解度の変化】
- このタスク、始める前はどのくらい難しそうでしたか? (1-5)
  1: 簡単そう
  3: 普通
  5: とても難しそう

- 実際やってみてどうでしたか? (1-5)
  1: 簡単だった
  3: 普通
  5: とても難しかった

→ この差が「理解度の向上」を示します!

【任意: 将来の分析に役立ちます】
- このタスクで新しく学んだことはありますか?
  → 例: 「エラーハンドリングの書き方」「テストの書き方」

- 似たタスクを前にもやったことがありますか? その時と比べて何か変わりましたか?
  → 例: 「前回は先輩に聞いたが、今回は自分で調べて解決できた」

- レビューや評価を受けましたか?
  → 例: 「指摘が多かった」「問題なく通った」

回答があれば、以下のコマンドで完了記録してください:

```bash
clap task done <ID> --difficulty-before 4 --difficulty-after 2 --learning "エラーハンドリングの書き方"
```
"""


def generate_reflect_prompt_with_data_gap(missing_fields: list, suggestions: list) -> str:
    """振り返り時のデータ不足指摘プロンプト"""

    if not suggestions:
        return ""

    prompt = """
【分析に必要なデータが不足しています】

より正確に「他人軸 vs 自分軸」を可視化するために、以下のデータを追記することをお勧めします:

"""

    for suggestion in suggestions:
        prompt += f"• {suggestion}\n"

    prompt += """
【追記方法】
過去の日記を振り返って、以下のように追記できます:

```bash
# 特定の日付の日記を更新
clap diary update 2026-02-10 --learned "学んだこと" --compared "過去との比較"

# 特定の日付の日記を表示して内容確認
clap diary show 2026-02-10
```

【なぜこれが重要か】
- 「学んだこと」: あなたの知識・スキルの蓄積を証明
- 「過去との比較」: 成長の軌跡を可視化
- これらがあると、「結果が出ない」≠「成長していない」を明確に証明できます

追記は任意ですが、データが充実するほど分析の精度が上がります。
"""

    return prompt
